<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>英语六级备考计划</title>
    <link rel="stylesheet" type="text/css" href="styles.css">
</head>

<body>
    <div class="container">
        <!-- 计划展示 -->
        <div class="plan">
            <h2>每日计划</h2>
            <div id="daily-plan"></div>
        </div>
        <!-- 打卡记录 -->
        <div class="record">
            <h2>打卡记录</h2>
            <div id="record-log"></div>
            <div class="input-group">
                <input type="text" id="record-text" placeholder="输入打卡内容">
                <input type="file" id="record-file" accept="image/*" multiple>
                <button onclick="addRecord()">添加打卡记录</button>
            </div>
            <div class="file-preview" id="file-preview"></div>
        </div>
    </div>

    <script>
        // 请求通知权限
        function requestNotificationPermission() {
            if (!("Notification" in window)) {
                alert("你的浏览器不支持通知功能。");
                return;
            }
            if (Notification.permission !== "granted") {
                Notification.requestPermission();
            }
        }
        requestNotificationPermission();

        // 任务通知功能
        function scheduleNotification(task, startTime) {
            const now = new Date();
            const notificationTime = new Date(startTime);

            if (notificationTime > now) {
                const timeDiff = notificationTime - now;
                setTimeout(() => {
                    if (Notification.permission === "granted") {
                        new Notification("任务提醒", {
                            body: `现在开始：${task}`,
                            icon: "https://via.placeholder.com/100",
                        });
                    }
                }, timeDiff);
            }
        }

        // 计划数据
        const tasks = [
            { time: "09:30", task: "单词记忆：不背单词APP（新词30-50个）" },
            { time: "10:00", task: "听力精听：近三年六级真题（1套，逐句跟读）" },
            { time: "11:10", task: "阅读理解：真题中1篇长篇阅读 + 1篇仔细阅读" },
            { time: "14:30", task: "单词复习：前一日单词复盘（不背单词）" },
            { time: "15:00", task: "听力训练：近三年六级真题（快速听2套，记录关键词）" },
            { time: "16:10", task: "作文练习：1篇作文 + 找模板对比，记录常用句型" },
            { time: "20:00", task: "翻译练习：2篇汉译英，分析长难句" },
        ];

        const today = new Date().toISOString().split("T")[0];

        // 显示计划并设置通知
        const dailyPlanElement = document.getElementById("daily-plan");
        tasks.forEach(({ time, task }) => {
            const [hours, minutes] = time.split(":");
            const taskTime = new Date(today);
            taskTime.setHours(parseInt(hours));
            taskTime.setMinutes(parseInt(minutes));
            taskTime.setSeconds(0);

            dailyPlanElement.innerHTML += `<div class="task"><strong>${time}</strong>: ${task}</div>`;
            scheduleNotification(task, taskTime);
        });

        // 文件预览
        function previewFiles() {
            const fileInput = document.getElementById("record-file");
            const filePreview = document.getElementById("file-preview");
            filePreview.innerHTML = ""; // 清空之前的预览
            Array.from(fileInput.files).forEach(file => {
                const reader = new FileReader();
                reader.onload = function (e) {
                    const img = document.createElement("img");
                    img.src = e.target.result;
                    filePreview.appendChild(img);
                };
                reader.readAsDataURL(file);
            });
        }

        // 打卡功能
        const recordLogElement = document.getElementById("record-log");
        function addRecord() {
            const text = document.getElementById("record-text").value.trim();
            const filePreview = document.getElementById("file-preview");

            if (!text && filePreview.children.length === 0) {
                alert("请输入内容或上传文件后再提交！");
                return;
            }

            const now = new Date();
            const date = now.toLocaleDateString();
            const time = now.toLocaleTimeString();

            let dayDiv = document.querySelector(`.day[data-date="${date}"]`);
            if (!dayDiv) {
                dayDiv = document.createElement("div");
                dayDiv.classList.add("day");
                dayDiv.setAttribute("data-date", date);
                dayDiv.innerHTML = `<h3>${date}</h3>`;
                recordLogElement.appendChild(dayDiv);
            }

            const timeBox = document.createElement("div");
            timeBox.classList.add("time-box");
            let content = `<div>
                    <strong>${time}</strong>: ${text ? text : "(无内容)"}
                </div>`;
            timeBox.innerHTML = content;

            // 添加文件预览
            const files = Array.from(filePreview.children);
            if (files.length > 0) {
                const fileContainer = document.createElement("div");
                files.forEach(file => {
                    const imgClone = file.cloneNode();
                    imgClone.style.maxWidth = "30%";
                    fileContainer.appendChild(imgClone);
                });
                timeBox.appendChild(fileContainer);
            }

            // 删除按钮
            const deleteButton = document.createElement("button");
            deleteButton.classList.add("delete-btn");
            deleteButton.innerText = "X";
            deleteButton.onclick = function () {
                if (confirm("确定删除这条记录吗？")) {
                    timeBox.remove();
                    if (dayDiv.children.length === 1) {
                        dayDiv.remove();
                    }
                }
            };
            timeBox.appendChild(deleteButton);

            dayDiv.appendChild(timeBox);

            // 清空输入框和文件选择内容
            document.getElementById("record-text").value = "";
            document.getElementById("record-file").value = "";
            filePreview.innerHTML = "";
        }
    </script>
</body>

</html>